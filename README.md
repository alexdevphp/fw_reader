# fw_reader
Упаковщик/распаковщик полных образов прошивок IP-камер Sricam SP009 и подобных им

Скрипт работает только с полными образами прошивок, которые зашиваются через программатор. С обновлениями прошивок не работает.

Работоспособность проверялась на образах для Sricam SP009 и им подобных размерами 8мб и 16мб.

<b>ИСПОЛЬЗОВАНИЕ</b>

<b>Распаковка:</b>

<i>php fw_reader.php прошивка.bin</i>

Результатом выполнения скрипта будет создание папки _прошивка.bin с файлами разделов (UBOOT.bin, LINUX.bin, FS.bin, USER0.bin, USER1.bin), и headers.dat
Название разделов в разных прошивках могут отличаться.

UBOOT.bin - начальный загрузчик<br>
LINUX.bin -Загрузчик Linux<br>
FS.bin - (squashfs) основной раздел системы<br>
USER0.bin - (jffs2) содержит настройки wifi, mac.ini, ID-пользователя и некоторые другие настройки<br>
USER1.bin - (jffs2) раздел обновлений прошивки<br>
SPI.bin - не разобрался, возможно используется для режима прошивки обновлений<br>

Файл headers.dat имеет следующую структуру:

GM8136 8388608 CAAAAAwAAAAYAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAFWq ; имя_процессора размер_образа_прошивки последние_36_байт_заголовка<br>
UBOOT 65536 458752 ; название начальный_адрес размер (далее структура одинакова)<br>
LINUX 524288 3145728<br>
FS 3670016 7864320<br>
USER0 11534336 1048576<br>

<b>Упаковка:</b>

<i>php fw_reader.php _прошивка.bin</i> (указать папку c распакованной прошивкой)

В результате будет создан новый файл прошивки pack_прошивка.bin

В случае, если после изменения разделов прошивки они не помещаются в образ, можно попробовать собрать его с опцией compact

<i>php fw_reader.php _прошивка.bin compact</i>

При этом прошивка будет собираться с игнорированием разметки в файле headers.dat. Внимание! Такой способ сборки может нарушить загрузку некоторых разделов (USER0).
